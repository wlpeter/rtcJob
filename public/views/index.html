<!doctype html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>GetUserMedia实例</title>
</head>
<body>
    <h1>11111111</h1>
    <input type="text" id="txt">
    <button onclick="rtcconnect()">连接</button>
    <input type="text" id="txt2">
    <button onclick="">断开</button>
    <video id="video" autoplay></video>
    <video id="video2" autoplay></video>
</body>

<script type="text/javascript">
    let iceServer = {
        "iceServers": [
            { "url": "turn:115.28.170.217:3478", "credential": "zmecust", "username": "zmecust" }
        ]
    };
    let getUserMedia = (navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia);
    let PeerConnection = window.RTCPeerConnection || window.mozRTCPeerConnection || window.webkitRTCPeerConnection || window.webkitPeerConnection00;
    let RTCSessionDescription = window.RTCSessionDescription || window.mozRTCSessionDescription || window.webkitRTCSessionDescription;
    let pc = new PeerConnection(iceServer);

    // 等候连接
    pc.onicecandidate = function(event){
        alert(event.candidate);
    };
    //如果检测到媒体流连接到本地，将其绑定到一个video标签上输出
    pc.onaddstream = function(event){
        let video2 = document.getElementById('video2');
        video2.src = URL.createObjectURL(event.stream);
    };
    getUserMedia.call(navigator, {
        video: true,
        audio: true
    }, (localMediaStream) => {
        let video = document.getElementById('video');
        video.src = window.URL.createObjectURL(localMediaStream);
        //向PeerConnection中加入需要发送的流
        pc.addStream(localMediaStream);
        // video.onloadedmetadata = (e) => {
        //     console.log("Label: " + localMediaStream);
        //     console.log("AudioTracks" , localMediaStream.getAudioTracks());
        //     console.log("VideoTracks" , localMediaStream.getVideoTracks());
        // };
    }, (e) => {
        console.log('Reeeejected!', e);
    });
    
    function sendOfferFn (desc){
        pc.setLocalDescription(desc);
        console.log('sendOfferFn');
        console.log(desc);
    }

    function sendAnswerFn  (desc){
        pc.setLocalDescription(desc);
        console.log('sendAnswerFn');
        console.log(desc);
    }
    function rtcconnect () {
        let candidate = document.getElementById('txt').value;
        if (!candidate) {
            alert('未填写')
        }
        pc.addIceCandidate(new RTCIceCandidate(candidate));
    }

    function disconnect () {
        let desc = document.getElementById('txt2').value;
        if (!desc) {
            alert('未填写')
        }
        pc.setRemoteDescription(new RTCSessionDescription(desc));
    }
</script>



</html>
